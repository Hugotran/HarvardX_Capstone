---
title: "Nest and Save data"
author: "Trần Phú Hòa"
date: "March 15, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Content
Clear workspace and free up memory
Load useful packages into R
Load "tidy_data"
Create nested "edx" dataset called "nested_edx.RData" including "nested_edx_userId", "nested_edx_movieId" and "nested_edx_genres".

Create nested "validation" dataset called "nested_validation.RData" including "nested_validation_userId", "nested_validation_movieId" and "nested_validation_genres".

Create nested "edx1" dataset called "nested_edx1.RData" including "nested_edx1_userId", "nested_edx1_movieId", "nested_edx1_movie_year", "nested_edx1_title", "nested_edx1_rating" and "nested_edx1_genres".

Create nested "tidy_edx" by userId called "nested_tidy_edx_userId.RData"

Create nested "tidy_edx" by movieId called "nested_tidy_edx_movieId.RData"

Create nested "tidy_edx" by movie_year called "nested_tidy_edx_movie_year.RData"

Create nested "tidy_edx" by title called "nested_tidy_edx_title.RData"

Create nested "tidy_edx" by rating called "nested_tidy_edx_rating.RData"

Create nested "tidy_edx" by genres called "nested_tidy_edx_genres.RData"

# Clear workspace and free up memory
```{r Clear workspace and free up memory, echo = FALSE}
rm(list = ls(all.names =  TRUE))
gc()
```

# Load useful packages into R
```{r Necessary packages, echo = FALSE}
if(!require(tidyverse)) install.packages("tidyverse", repos = "http://cran.us.r-project.org")

#to create training, testing and validation splits
if(!require(rsample)) install.packages("rsample", repos = "http://cran.us.r-project.org") 
```

# Load "tidy_data" dataset including edx, tidy_edx, edx1 and validate_tidy_edx

```{r}
#Load edx data from my workspace "HarvardX_Capstone_MovieLens"
load("C:/Tran Phu Hoa workspace/1. Current/HarvardX_Capstone/MediaLens_data.RData")
load("C:/Tran Phu Hoa workspace/1. Current/HarvardX_Capstone/tidy_edx.RData")
load("C:/Tran Phu Hoa workspace/1. Current/HarvardX_Capstone/edx1.RData")
load("C:/Tran Phu Hoa workspace/1. Current/HarvardX_Capstone/validate_tidy_edx.RData")
```

## Nest and save data
### Nesting "edx" and "validation" by userId, movieId, and genres
```{r Nesting "edx" and "validation", echo = FALSE }
nested_edx_userId <- edx %>% group_by(userId) %>% nest()
nested_edx_movieId <- edx %>% group_by(movieId) %>% nest()
nested_edx_genres <- edx %>% group_by(genres) %>% nest()

nested_validation_userId <- validation %>% group_by(userId) %>% nest()
nested_validation_movieId <- validation %>% group_by(movieId) %>% nest()
nested_validation_genres <- validation %>% group_by(genres) %>% nest()
```

### Save "edx" and "validation"
```{r}
save(nested_edx_userId, 
     nested_edx_movieId, 
     nested_edx_genres, 
     file = "nested_edx.RData")
```

```{r}
save(nested_validation_userId,
     nested_validation_movieId, 
     nested_validation_genres, 
     file = "nested_validation.RData")
```


### Nesting edx1 by userId, movieId, genres, movie_year, date_of_rating, title, rating
To nest date_of_rating I need to change my approach, so I will leave it to near future
nested_edx1_date_of_rating <- edx1 %>% group_by(date_of_rating) %>% nest()
```{r , echo = FALSE}
nested_edx1_userId <- edx1 %>% group_by(userId) %>% nest()
nested_edx1_movieId <- edx1 %>% group_by(movieId) %>% nest()
nested_edx1_movie_year <- edx1 %>% group_by(movie_year) %>% nest()
nested_edx1_title <- edx1 %>% group_by(title) %>% nest()
nested_edx1_rating <- edx1 %>% group_by(rating) %>% nest()
nested_edx1_genres <- edx1 %>% group_by(genres) %>% nest()
```
```{r}
save(nested_edx1_userId,
     nested_edx1_movieId,
     nested_edx1_movie_year,
     nested_edx1_title,
     nested_edx1_rating,
     nested_edx1_genres,
     file = "nested_edx1.RData")
```


### Nesting tidy_edx by userId, date_of_rating, movieId, movie_year, title, rating and genres
I have to create, save and remove those data sets in order to not being caught in to memory limitation trouble.


```{r "Nesting tidy_edx by userId, date_of_rating, movieId, movie_year, title, rating and genres", echo = FALSE }
rm("edx", "edx1", "validate_tidy_edx", "validation", "nested_edx1_genres", "nested_edx1_movie_year", "nested_edx1_movieId", "nested_edx1_rating", "nested_edx1_title", "nested_edx1_userId", "nested_validation_genres", "nested_validation_movieId", "nested_validation_userId", "nested_edx_genres", "nested_edx_movieId", "nested_edx_userId")

nested_tidy_edx_userId <- tidy_edx %>% group_by(userId) %>% nest()
save(nested_tidy_edx_userId, file = "nested_tidy_edx_userId.RData")
rm(nested_tidy_edx_userId)
```

```{r}
nested_tidy_edx_movieId <- tidy_edx %>% group_by(movieId) %>% nest()
save(nested_tidy_edx_movieId, file = "nested_tidy_edx_movieId.RData")
rm(nested_tidy_edx_movieId)


nested_tidy_edx_movie_year <- tidy_edx %>% group_by(movie_year) %>% nest()
save(nested_tidy_edx_movie_year, file = "nested_tidy_edx_movie_year.RData")
rm(nested_tidy_edx_movie_year)

nested_tidy_edx_title <- tidy_edx %>% group_by(title) %>% nest()
save(nested_tidy_edx_title, file = "nested_tidy_edx_title.RData")
rm(nested_tidy_edx_title)

nested_tidy_edx_rating <- tidy_edx %>% group_by(rating) %>% nest()
save(nested_tidy_edx_rating, file = "nested_tidy_edx_rating.RData")
rm(nested_tidy_edx_rating)

nested_tidy_edx_genres <- tidy_edx %>% group_by(genres) %>% nest()
save(nested_tidy_edx_genres, file = "nested_tidy_edx_genres.RData")
rm(nested_tidy_edx_genres)

```

### Saving nested tidy_edx by userId, date_of_rating, movieId, movie_year, title, rating and genres

#FALSE to run ```{r "Save nested tidy_edx by userId, date_of_rating, movieId, movie_year, title, rating and genres", echo = FALSE}
save(nested_tidy_edx_userId, 
     nested_tidy_edx_movieId,
     nested_tidy_edx_movie_year,
     nested_tidy_edx_title,
     nested_tidy_edx_rating,
     nested_tidy_edx_genres,
     file = "nested_tidy_edx.RData")


### Nesting date_of_rating
To nest date_of_rating I need to change my approach, so I will leave it to near future

nested_edx1_date_of_rating <- edx1 %>% group_by(date_of_rating) %>% nest()
nested_tidy_edx_date_of_rating <- tidy_edx %>% group_by(date_of_rating) %>% nest()
